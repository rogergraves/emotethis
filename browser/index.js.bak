
var AppState = {
	currentPage: 'instruction',
	prevPage: '',
	
	stimulusShortDesc: '&nbsp;',
	stimulusPageName: 'Instructions',
	
	emoteFacePick: '',
	emoteShortDesc: 'Move your mouse over face to change emotion. Click to set.',
	emotePageName: 'Emote',
	
	emoteFollowId: null,
	emotePickerId: null,
	emotePickerFaceId: null,
	emotePickerFaceNameId: null,
	emoteMouseFollow: 0,
	emoteMouseFollowOff: 0,
	
	emoteFaceCol: 2,
	emoteFaceRow: 7,
	
	intensityPickerFaceId: null,
	intensityPickerId: null,
	intensityMouseFollow: 0,
	intensityMouseFollowOff: null,
	intensityBgId: null,
	
	intensityFaceCol: 2,
	intensityPos: '',
	
	intensityShortDesc: 'Move your mouse over face to change intensity. Click to set.',
	intensityPageName: 'Intensity',
	
	currentDot: 1,
	
	verbatimShortDesc: '&nbsp;'
};

var faceNames = {
	'1_1': 'outraged',
	'1_2': 'angry',
	'1_3': 'unhappy',
	'1_4': 'frustrated',
	'1_5': 'disgusted',
	'1_6': 'miserable',
	'1_7': 'irritated',
	'1_8': 'humiliated',
	'1_9': 'dissatisfied',
	'1_10': 'uneasy',
	'2_1': 'delighted',
	'2_2': 'elated',
	'2_3': 'happy',
	'2_4': 'excited',
	'2_5': 'thrilled',
	'2_6': 'enthusiastic',
	'2_7': 'amazed',
	'2_8': 'surprised',
	'2_9': 'satisfied',
	'2_10': 'content'
};

var faceIntensity = {
	'1_1': {
			img: 'outraged.png',
			color: '#ca2828'
		},
	'1_2': {
			img: 'angry.png',
			color: '#ca2828'
		},
	'1_3': {
			img: 'unhappy.png',
			color: '#ca2828'
		},
	'1_4': {
			img: 'frustrated.png',
			color: '#ca2828'
		},
	'1_5': {
			img:'disgusted.png',
			color: '#ca2828'
		},
	'1_6': {
			img: 'miserable.png',
			color: '#ca2828'
		},
	'1_7': {
			img: 'irritated.png',
			color: '#ca2828'
		},
	'1_8': {
			img: 'humiliated.png',
			color: '#ca2828'
		},
	'1_9': {
			img: 'dissatisfied.png',
			color: '#ca2828'
		},
	'1_10': {
			img: 'uneasy.png',
			color: '#ca2828'
		},
	'2_1': {
			img: 'delighted.png',
			color: '#ca2828'
		},
	'2_2': {
			img: 'elated.png',
			color: '#ca2828'
		},
	'2_3': {
			img: 'happy.png',
			color: '#ca2828'
		},
	'2_4': {
			img: 'excited.png',
			color: '#ca2828'
		},
	'2_5': {
			img: 'thrilled.png',
			color: '#ca2828'
		},
	'2_6': {
			img: 'enthusiastic.png',
			color: '#ca2828'
		},
	'2_7': {
			img: 'amazed.png',
			color: '#ca2828'
		},
	'2_8': {
			img: 'surprised.png',
			color: '#ca2828'
		},
	'2_9': {
			img: 'satisfied.png',
			color: '#ca2828'
		},
	'2_10': {
			img: 'content.png',
			color: '#ca2828'
		}
};

jQuery.preloadImages = function(){
	for(var i = 0; i<arguments.length; i++){
		jQuery("<img>").attr("src", arguments[i]);
	}
}

function setEmoteFace(numCol,numRow){
	if(numRow < 1) numRow = 1;
	if(numRow > 10) numRow = 10; 
	
	if(numCol < 1) numCol = 1;
	if(numCol > 2) numCol = 2;
	
	if(numCol != AppState.emoteFaceCol || numRow != AppState.emoteFaceRow){
		var offset_x = (numCol - 1) * 260;
		var offset_y = (numRow - 1) * 280 + 25;
		AppState.emotePickerFaceId.css({'background-position' : offset_x +'px'+' -' + offset_y + 'px' });

		var faceName = faceNames[numCol + '_' + numRow];

		AppState.emotePickerFaceNameId.html(faceName.toUpperCase());
		AppState.emoteFaceCol = numCol;
		AppState.emoteFaceRow = numRow;
	}
}

function setIntensityFace(numCol){
	
	if(numCol < 1) numCol = 1;
	if(numCol > 3) numCol = 3;
	
	numCol = 3 - numCol;
	
	if(numCol != AppState.intensityFaceCol){
		var offset_x = numCol * 260;
		
		AppState.intensityPickerFaceId.css({'background-position' : '-' + offset_x +'px' + ' ' +  '-25px' });
		
		AppState.intensityFaceCol = numCol;
	}
	var faceName = faceNames[AppState.intensityPos];
	var strFaceName = '';
	if(numCol == 0)
		strFaceName = 'A LITTLE ' + faceName;
	else if(numCol == 1)
		strFaceName = faceName;
	else if(numCol == 2)
		strFaceName = 'VERY ' + faceName;
	
	AppState.intensityPickerFaceNameId.html(strFaceName.toUpperCase());
}

function goEmote(){
	AppState.prevPage = AppState.currentPage;
	AppState.currentPage = 'emote';
	
	$("#slider").sudoSlider(2);
	changeDot(2);
	
	switchBackButton(1);
	if(! AppState.emoteMouseFollowOff){
		switchNextButton(0);
	}
	$("#short-desc").html(AppState.emoteShortDesc);	
}

function goIntensity(){
	AppState.prevPage = AppState.currentPage;
	AppState.currentPage = 'intensity';
	
	var faceId = AppState.emoteFaceCol + '_' + AppState.emoteFaceRow;
	var intensityData = faceIntensity[faceId];
//	console.log(AppState.numCol + '_' + AppState.numRow + " " + intensityData);
	var imgSrc = "../images/browser/" + intensityData.img;
	
	if(faceId != AppState.intensityPos){
		AppState.intensityBgId.css({'height' : '160px'});
		
		jQuery.preloadImages(imgSrc);
		AppState.intensityPickerFaceId.css({'background' : "url('" + imgSrc + "') -260px -25px"});
		
		$('#current-face-name').html(faceNames[faceId]);
		$('#intensity-face-name').html(faceNames[faceId].toUpperCase());
		AppState.intensityPos = faceId;
	}
	
//	this.faceName = App.ui.emotePage.faceNames[emoteId];
//	Ext.get('iface-name').update(this.faceName.toUpperCase());
	$("#slider").sudoSlider(3);
	changeDot(3);
	if(AppState.intensityMouseFollowOff){
		switchNextButton(1);
	}else{
		switchNextButton(0);
	}
	$("#short-desc").html(AppState.intensityShortDesc);
	
}

function goStimulus(){
	AppState.prevPage = AppState.currentPage;
	AppState.currentPage = 'instruction';
	
	$("#slider").sudoSlider(1);
	changeDot(1);
	
	switchBackButton(0);
	switchNextButton(1);
	
	$("#short-desc").html(AppState.stimulusShortDesc);
}

function goVerbatim(){
	AppState.prevPage = AppState.currentPage;
	AppState.currentPage = 'verbatim';
	
	var faceId = AppState.emoteFaceCol + '_' + AppState.emoteFaceRow;
	var faceName = faceNames[faceId];

	var intensityCol = AppState.intensityFaceCol + 1;
	var imgSrc = '../images/browser/small/' + faceName + "_intensity_" + intensityCol +".png";
	
	jQuery.preloadImages(imgSrc);
	$("#verbatim-image-id").attr("src", imgSrc);
	
	var strFaceName = '';
	if( AppState.intensityFaceCol == 0)
		strFaceName = 'A LITTLE ' + faceName;
	else if(AppState.intensityFaceCol == 1)
		strFaceName = faceName;
	else if(AppState.intensityFaceCol == 2)
		strFaceName = 'VERY ' + faceName;
	
	$("#verbatim-face-name").html(strFaceName.toUpperCase());
	//$("#verbatim-textarea").val("I felt " + strFaceName.toUpperCase() + " about the Arabiatta Sauce because...");
	
	$("#slider").sudoSlider(4);
	changeDot(4);
	switchNextButton(0);
	$("#short-desc").html(AppState.verbatimShortDesc);
}

function changeDot(dotId){
	$('#dots-nav').find("img").attr('src', '../images/browser/white_dot.png');
	$('#dot-' + numDot).attr('src', '../images/browser/yellow_dot.png');
}

function switchBackButton(onState){
	if(onState){
		$("#back-button-on").attr('src','../images/browser/back_button.png');
		$("#back-button-on").attr('usemap','#back-button-map');
	}else{
		$("#back-button-on").attr('src','../images/browser/back_button_off.png');
		$("#back-button-on").attr('usemap','');
	}
}

function switchNextButton(onState){
	if(onState){
		$("#next-button-on").attr('src','../images/browser/next_button.png');
		$("#next-button-on").attr('usemap','#next-button-map');
	}else{
		$("#next-button-on").attr('src','../images/browser/next_button_off.png');
		$("#next-button-on").attr('usemap','');
	}
}


var Navigation = function(){
	
};


$(document).ready(function(){
	
	//store id for fast access
	AppState.emoteFollowId = $("#emote-mouse-follow");
	AppState.emotePickerId = $("#emote-picker");
	AppState.emotePickerFaceId = $("#emote-face");
	AppState.emotePickerFaceNameId = $("#emote-face-name");
	
	AppState.intensityFollowId = $("#intensity-mouse-follow");
	AppState.intensityPickerFaceId = $("#intensity-face");
	AppState.intensityPickerId = $("#intensity-picker");
	AppState.intensityBgId = $("#intensity-bg2");
	AppState.intensityPickerFaceNameId = $("#intensity-face-name")
	
	var preloadImages = [
			'../images/browser/emote_logo.png',
			'../images/browser/back_button.png',
			'../images/browser/next_button.png',
			'../images/browser/bottle_item.png',
			'../images/browser/yellow_dot.png',
			'../images/browser/white_dot.png',
			'../images/browser/bg.jpg',
			'../images/browser/left_window_background.png',
			'../images/browser/emotion_picker_window.png',
			'../images/browser/intensity_window_min.png',
			'../images/browser/first_faces_transparent_bg.png',
			'../images/browser/content.png',
			'../images/browser/intensity_meter_background.png',
			'../images/browser/intensity_window_max.png',
			'../images/browser/mouse_follow_image.png',
			'../images/browser/emoticon_shadow.png',
			'../images/browser/next_button_off.png',
			'../images/browser/back_button_off.png',
			'../images/browser/verbatim_window_background.png',
			'../images/browser/verbatim_submit_button.png',
			'../images/browser/loading_win.png'
	];

	switchBackButton(0);
	
	$("#main-content").show();
	
	$("#slider").sudoSlider({
		speed : 600
		,ease: 'easeOutQuart'
		,prevNext:false
	});
	
	$("#next-button area").click(function(){
		if(AppState.currentPage == 'instruction'){
			goEmote();
		}
		else if(AppState.currentPage == 'emote'){
			goIntensity();
		}else if(AppState.currentPage == 'intensity'){
			goVerbatim();
		}
	});
	
	$("#back-button area").click(function(){
		if(AppState.currentPage == 'emote'){
			goStimulus();
		}
		else if(AppState.currentPage == 'intensity'){
			goEmote();
		}
		else if(AppState.currentPage == 'verbatim'){
			goIntensity();
		}
	});
	
	$("#emote-picker").mousemove(function(e){
		if(AppState.emoteMouseFollowOff)
			return;
		var cursorX = e.pageX - 13;
		var cursorY = e.pageY - 13;
		
		
		var offset = AppState.emotePickerId.offset();
		
		var em_h = AppState.emotePickerId.height();
		var em_w = AppState.emotePickerId.width();
		
		var offLeft = cursorX - offset.left;
		var offTop = cursorY - offset.top;
		
		setEmoteFace(Math.ceil(offLeft / (em_w/2)), Math.ceil(offTop / ((em_h-20)/10)));
		
		if(offTop < 13 ) 
			offTop = 4;
		else if(offTop > em_h - 30)
			offTop = em_h - 30;
		
		
		if(offLeft < 13) 
			offLeft = 4;
		else if(offLeft > em_w - 30)
			offLeft = em_w - 30;
		
			
		AppState.emoteFollowId.css({'left' : offLeft + 'px', 'top' : offTop + 'px'});
			
		if(AppState.emoteFollowId.is(':hidden')){
			AppState.emoteFollowId.show();
			AppState.emoteMouseFollow = 1;
		}
	

	});
	
	$("#emote-picker").click(function(e){
		if(AppState.emoteMouseFollowOff){
			
			var cursorX = e.pageX - 13;
			var cursorY = e.pageY - 13;
			var offset = AppState.emotePickerId.offset();
			
			var offLeft = cursorX - offset.left;
			var offTop = cursorY - offset.top;
			
			var em_h = AppState.emotePickerId.height();
			var em_w = AppState.emotePickerId.width();
			
			setEmoteFace(Math.ceil(offLeft / (em_w/2)), Math.ceil(offTop / ((em_h-20)/10)));

			if(offTop < 13 ) 
				offTop = 4;
			else if(offTop > em_h - 30)
				offTop = em_h - 30;
			
			
			if(offLeft < 13) 
				offLeft = 4;
			else if(offLeft > em_w - 30)
				offLeft = em_w - 30;
			
			AppState.emoteFollowId.css({'left' : offLeft + 'px', 'top' : offTop + 'px'});
			AppState.emoteMouseFollowOff = 0;
			switchNextButton(0);
		}
		else{
			AppState.emoteMouseFollowOff = 1;
			switchNextButton(1);
		}
	});
	
	
//	$("#intensity-picker, #intensity-bg2").mousemove(function(e){
	$("#intensity-picker").mousemove(function(e){
		if(AppState.intensityMouseFollowOff)
			return;
		var cursorX = e.pageX - 13;
		var cursorY = e.pageY - 13;
		
		var offset = AppState.intensityPickerId.offset();
		
		var em_h = AppState.intensityPickerId.height();
		var em_w = AppState.intensityPickerId.width();
		
		var offLeft = cursorX - offset.left;
		var offTop = cursorY - offset.top;
		
		setIntensityFace(Math.ceil(offTop / ((em_h-20)/3)));
		
		if(offTop < 13 ) 
			offTop = 4;
		else if(offTop > em_h - 30)
			offTop = em_h - 30;
		
		
		if(offLeft < 13) 
			offLeft = 4;
		else if(offLeft > em_w - 30)
			offLeft = em_w - 30;
		
		AppState.intensityFollowId.css({'left' : offLeft + 'px', 'top' : offTop + 'px'});
		
		
		var bg_h = offset.top + em_h - e.pageY;
		AppState.intensityBgId.css({'height' : bg_h + 'px'});
		
		
		AppState.intensityMouseFollowOff = 0;
		switchNextButton(0);
		
		if(AppState.intensityFollowId.is(':hidden')){
			AppState.intensityFollowId.show();
			AppState.intensityMouseFollow = 1;
		}
		
	});
	
	$("#intensity-picker").click(function(e){
		if(AppState.intensityMouseFollowOff){
			
			var cursorX = e.pageX - 13;
			var cursorY = e.pageY - 13;
			var offset = AppState.intensityPickerId.offset()
			
			var offLeft = cursorX - offset.left;
			var offTop = cursorY - offset.top;
			
			var em_h = AppState.intensityPickerId.height();
			var em_w = AppState.intensityPickerId.width();
			
			setIntensityFace(Math.ceil(offTop / ((em_h-20)/3)));
			
			if(offTop < 13 ) 
				offTop = 4;
			else if(offTop > em_h - 30)
				offTop = em_h - 30;
			
			
			if(offLeft < 13) 
				offLeft = 4;
			else if(offLeft > em_w - 30)
				offLeft = em_w - 30;
			
			AppState.intensityFollowId.css({'left' : offLeft + 'px', 'top' : offTop + 'px'});
			
			var bg_h = offset.top + em_h - e.pageY;
			AppState.intensityBgId.css({'height' : bg_h + 'px'});

			
			AppState.intensityMouseFollowOff = 0;
			switchNextButton(0);
			
		}
		else{
			switchNextButton(1);
			AppState.intensityMouseFollowOff = 1;
		}
	});
	
	
	$("#verbatim-textarea").focus(function(e){
		$("#verbatim-textarea").val('');
	});
	
	
	$.preload(preloadImages,{
		onFinish : function(){ 
			$("#loading").fadeOut("fast");
			$("#loading-mask").fadeOut("slow");
		}
	
		,onComplete : function(load){
			console.log("load image: "+ load.total + " - " + load.done);
		}
	});
	

});

//http://www.netzgesta.de/glossy/
//http://jreject.turnwheel.com/