<?php 


require_once('config.php');
require_once(ROOT_PATH . 'includes/Template.php');
require_once(ROOT_PATH . 'includes/Model.php');

try{
#	$survey_tpl = new Template('test01.php');

	$survey_manager = new SurveyManager();
	if(array_key_exists('action',$_REQUEST) && $_REQUEST['action'] == 'getsurvey'){
		$send_obj=array();
		if(array_key_exists('survey',$_REQUEST) && $survey_manager->isSurvey($_REQUEST['survey'])){
			$survey = $survey_manager->getSurvey($_REQUEST['survey']);
	
			$survey_tpl = new Template('survey_ajax.php');
			
			$send_obj = array(
				'status' => 'ok',
				'html' => $survey_tpl->process(array('survey' => $survey, 'not_welcome' => true))
			);
		}else{
			$send_obj = array(
				'status' => 'error',
				'html' => 'Survey not found'
			);
		}
		
		$strToSend=json_encode($send_obj);
		print $strToSend;
	}else if(array_key_exists('survey',$_REQUEST) && $_REQUEST['survey'] && $survey_manager->isSurvey($_REQUEST['survey'])){
		$survey = $survey_manager->getSurvey($_REQUEST['survey']);
	
		$survey_tpl = new Template('survey_body.php');
		print $survey_tpl->process(array('survey' => $survey));
	}else if(){
		
	}else{
		$survey_tpl = new Template('survey_code_body.php');
		print $survey_tpl->process(array());
	}
}catch(Exception $e){
	print "Something wrong...";
}


?>